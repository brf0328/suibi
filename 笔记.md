
#蒙卡罗特抽样
##逆变换和舍选抽样法

import numpy as np
import matplotlib.pyplot as plt
# 指定默认字体为 SimHei（黑体），用来正常显示中文
plt.rcParams['font.sans-serif'] = ['SimHei']
# 解决保存图像时负号 '-' 显示为方块的问题
plt.rcParams['axes.unicode_minus'] = False
#Beta(3,2)的密度函数
def p(x):
    return 12 * x**2 * (1 - x)

def M_func(x):
    if 0 <= x <= 0.8:
        return 3 * x
    elif 0.8 < x <= 1:
        return 12 * (1 - x)
    else:
        return 0

def sample_beta_rt():
    count = 0
    while True:
        count += 1
        #逆变换抽样
        if np.random.random() < 0.96 / 1.2:
            x = 0.8 * np.sqrt(np.random.random())
        else:
            x = 1 - 0.2 * np.sqrt(np.random.random())

        # 舍选
        if np.random.random() <= p(x) / M_func(x):
            return x, count

n = 10000
samples = []
total_iters = 0
for _ in range(n):
    x, iters = sample_beta_rt()
    samples.append(x)
    total_iters += iters

empirical_avg_iters = total_iters / n
theoretical_avg_iters = 1.2  # 理论平均迭代次数 = 总面积1.2/1 =1.2

# 绘制样本直方图和理论密度曲线
x_vals = np.linspace(0, 1, 200)
y_vals = p(x_vals)

plt.hist(samples, bins=30, density=True, alpha=0.7, edgecolor='black', label='样本密度直方图')
plt.plot(x_vals, y_vals, 'r-', linewidth=2, label='理论密度函数')
plt.title('舍选采样: Beta(3,2)')
plt.xlabel('x')
plt.ylabel('密度')
plt.legend()
plt.show()

# 输出结果
print(f"理论平均迭代次数：{theoretical_avg_iters}")
print(f"实际平均迭代次数：{empirical_avg_iters:.4f}")
